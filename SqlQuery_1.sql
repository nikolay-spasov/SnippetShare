DECLARE @CurrentMigration [nvarchar](max)

IF object_id('[dbo].[__MigrationHistory]') IS NOT NULL
    SELECT @CurrentMigration =
        (SELECT TOP (1) 
        [Project1].[MigrationId] AS [MigrationId]
        FROM ( SELECT 
        [Extent1].[MigrationId] AS [MigrationId]
        FROM [dbo].[__MigrationHistory] AS [Extent1]
        WHERE [Extent1].[ContextKey] = N'SnippetShare.Domain.Migrations.Configuration'
        )  AS [Project1]
        ORDER BY [Project1].[MigrationId] DESC)

IF @CurrentMigration IS NULL
    SET @CurrentMigration = '0'

IF @CurrentMigration < '201403180916287_initial'
BEGIN
    CREATE TABLE [dbo].[Snippets] (
        [Id] [int] NOT NULL IDENTITY,
        [Title] [nvarchar](256),
        [Content] [nvarchar](max),
        [DatePublished] [datetime] NOT NULL,
        [UserId] [int],
        CONSTRAINT [PK_dbo.Snippets] PRIMARY KEY ([Id])
    )
    CREATE INDEX [IX_UserId] ON [dbo].[Snippets]([UserId])
    CREATE TABLE [dbo].[UserProfile] (
        [UserId] [int] NOT NULL IDENTITY,
        [UserName] [nvarchar](max),
        CONSTRAINT [PK_dbo.UserProfile] PRIMARY KEY ([UserId])
    )
    ALTER TABLE [dbo].[Snippets] ADD CONSTRAINT [FK_dbo.Snippets_dbo.UserProfile_UserId] FOREIGN KEY ([UserId]) REFERENCES [dbo].[UserProfile] ([UserId])
    CREATE TABLE [dbo].[__MigrationHistory] (
        [MigrationId] [nvarchar](150) NOT NULL,
        [ContextKey] [nvarchar](300) NOT NULL,
        [Model] [varbinary](max) NOT NULL,
        [ProductVersion] [nvarchar](32) NOT NULL,
        CONSTRAINT [PK_dbo.__MigrationHistory] PRIMARY KEY ([MigrationId], [ContextKey])
    )
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201403180916287_initial', N'SnippetShare.Domain.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592BC9A2451BD8BB489DA430767341945DF42DA0A5B14394A254920A6C14FDB23EF493FA0B1DEA668994E54B924D8BBC3814E7CC70E6CC7046FAE7AFBF87EF1731278F20154BC4C83B1A1C7A044498444CCC475EA6676F7EF4DEBFFBFAABE179142FC8E76ADF5BB30F25851A790F5AA727BEAFC20788A91AC42C94894A667A1026B14FA3C43F3E3CFCC93F3AF201213CC42264789B09CD62C8FFC17FC7890821D519E59749045C95EBF824C851C9158D41A5348491170896A6A083072A617096C494098F9C7246D19400F8CC23548844538D869E7C52106899887990E202E577CB1470DF8C7205E5014E56DBB73DCBE1B1398BBF12ACA0C24C69B46837C0A3B7A5737C5B7C2F177BB5F3D07DE7E866BD34A7CE5D587BCF23B6AE933197665FA78307390E0335281F1E908E5D07353F9046E6EF808C33AE330923019996941F909B6CCA59F8019677C96F204622E3BC69309A8CCF5A0BB874239314A45EDEC2AC3CC624F288DF96F36DC15AAC21539C7022F4DB638F5CA1723AE550F3A1E18D4027127E0101926A886EA8D62085C180DCA38E764BD71DD31C2A75C840CC268F5CD2C5471073FD30F28EBFFFC123176C0151B5529AF049304C3E14D232834D5A306D34DAD3A3077F3E839E33F4411E38F500B513CDE21DE670871FFBD13027A5130B4BE48A3EB2791E890E618FDC02CF1FAA079616595F11F3BED8702193F836E12B36E7EBF74192C9D0C425E9787847E5DC6446D394A1BFCAA0DEBC320868EA8C99B0EF995B0D8CD7CEAF2A46BBE658676C5F30CF8C3EF3EB9953605DD84F954A42965BDEAEA705EDDAA69E8B88F471B030B8C15D341BC3C9520C20EA1E79DF39A75F035931B701D9E2631BF6703038729031F4208DCF29C7AAA2904C4C6897274C842CA5BCC7084B66077619B7D71AEC2767908230A4E871E9D354D71A2CCA6FF2CCD06FB0C2AD11A646A304C83661F2BC3E9BE6157CD1751DA3A165D55025436D2A18F400741B577964455D9B5E0E9BDA100DCE74C1B4286541355CE0985496E4C696AE926DC76343F6D4B6374FEE047543BE3440DA67B7CB5EFB781D85A28EF2AA73F58BD6B56A71FD353DEEF092A629D6AC46CF5BAE90A06878C76F82DD1BC1B8C0F043D5D10FD6D6D69AB00AD339584F4D8311C105934AE3654FA7D454CD71143BDBBA39BD866C954E8BB66EE82AFA5502E6B79B43D52D5A91DC2D02A5FC059E30360524BF725CFEB892F9F84139951D8DE438E1592CD635A37DD2656BD8042897B6C7A81BBF264ABDB83D8ED5D835D1AC47DB635615B609B6AEEA9ABCB0C2E3D4658708566EDAC4DA8A76AD747F2AF59A857177FAF54A3F8F93FB508AEEC9C62956BF70B89C626A6FA9B5D745D52A9EC3B2906D7E8BE054B6628B47D0458F2CCAABDA5269880766C320F89D8F39CBB3ABDA7049059B81D245A3EDE11C7F6CBD87F8EFBC13F0958AF8762F06BEF830CE8C53378E013BCE98ADF95B3C521962C2BA13F80A758F71BB82FD26A68B6F77C5EA1CA9235CD44F1FA9738F3A0DE5049BDBC5C8FB23173921935FEF0BA903722D91CE27E490FCD97F8ABD86E1571B3E5F8457F6BCB903079E79A66C75E34F18FC9C1679BFC974AFF9B1FFE27CC9B9F1FF312BBAEDF7563360DF08585C73586AA60906BAE0EABA01AA6F40DC341F76E979AD01B2C36CA7F3DA6276EC1A3A5F665474BB18A456E38B09B25AB1F90AC27C3F1110B64855EF9988595271DBB2A8DA6215B94BD014AF227A2A359BD150E3E31094CA5FAC7DA63CC32DE7F114A289B8CE749A693C32C453DE7A596772A44F7F3E0FB76D1E5EA7F93BDDE738029AC9CC6D7A2D7ECE188F6ABB2FDC22BF0EC2245F797398586A7383CC9735D25522B6042ADD57D78C3B88538E60EA5A04F411F6B10D99FB11E6345C56CDE87A90CD8168BB7D78C6E85CD25895182B79F315D0379F01DFFD0B38DB903D381C0000 , N'6.1.0-30225')
END

IF @CurrentMigration < '201403182042425_snippetIdChangedToLong'
BEGIN
    ALTER TABLE [dbo].[Snippets] DROP CONSTRAINT [PK_dbo.Snippets]
    ALTER TABLE [dbo].[Snippets] ALTER COLUMN [Id] [bigint] NOT NULL
    ALTER TABLE [dbo].[Snippets] ADD CONSTRAINT [PK_dbo.Snippets] PRIMARY KEY ([Id])
    INSERT [dbo].[__MigrationHistory]([MigrationId], [ContextKey], [Model], [ProductVersion])
    VALUES (N'201403182042425_snippetIdChangedToLong', N'SnippetShare.Domain.Migrations.Configuration',  0x1F8B0800000000000400D559DB6EE336107D2FD07F20F4D416592B9776D106F62E52275904DD5C1065177D0B6869EC10A52895A4021B45BFAC0FFDA4FE4287BA592265F99264D3222F0EC539339C39339C91FEF9EBEFE1FB79CCC92348C51231F20E06FB1E0111261113B39197E9E99B1FBDF7EFBEFE6A7816C573F2B9DA7764F6A1A45023EF41EBF4D8F755F80031558398853251C9540FC224F66994F887FBFB3FF907073E20848758840C6F33A1590CF93FF8EF381121A43AA3FC328980AB721D9F04392AB9A231A8948630F202C1D21474F040250C4E939832E19113CE289A12009F7A840A9168AAD1D0E34F0A022D13310B525CA0FC6E9102EE9B52AEA03CC0F172FBA667D93F3467F19782155498298D166D077870543AC7B7C57772B1573B0FDD77866ED60B73EADC85B5F73C62EB3A1E7369F6753A7890E3305083F2E11EE9D8B557F3036964FEF6C838E33A933012906949F91EB9C9269C85BFC0E22EF90DC448649C370D4693F1596B01976E649282D48B5B9896C7B8883CE2B7E57C5BB0166BC81427BC10FAEDF71EB942E574C2A1E643C31B814E247C0001926A886EA8D62085C180DCA38E764BD71DD31C2A75C840CC268F5CD2F9471033FD30F20E7F78EB91733687A85A294DF82418261F0A6999C13A2D98361AEDE9D1833F9F41CF29FA200F9C7A80DA8966F10E73B8C38FFD689893B2158BA34347E48A3EB2591E890E618FDC02CF1FAA079616595F11F3BED8702E93F836E14B36E7EBF74192C9D0C425E9787847E5CC6446D394A1BFCCA0DEBC320868EA9499B0EF985B0D8CD7CEAF2A46DBE658676C5F30CF8C3EF3EB99536055D84F944A42965BDEAEA705EDDAA69E8988F471B030B8C15D341BC3C9520C20EA1E79DF39A75F015931B701D9E2631B767F3038709031F4208DCF29C7AAA2904C4C6897274C842CA5BCC7084B660B7619B7D71AEC27A7908230A4E871E9D354D71A2CCAAFF3CCD06FB0C2AD11A646A304C83661F2BC3E9DE4157CDE751DA3A165D55025436D2A18F400741B577964495D9B5E0E9BDA100DCE74C1B4286541355CE0985496E4C696AE926DC7634DF6D4B6374FEE04754DBE3440DA67B7CB5EFB781D85A28EF2B273F58BD6B56A71FD153DEEF092A629D6AC46CF5BAE90A06878C76F82ED1BC1B8C0F043D5D10FD6D6D69AB00AD319584F4D8311C139934AE3654F27D454CD71143BDBBA39BD826C954E8BB66EE82AFA5502E6B79B43D52D5A91DC2D02A5FC399E30360524BF725CFEB892F9F84139951D8DE438E1592C5635A37DD2656BD804289736C7A81BBF264ABDB8398ED5D835D1AC479B635615B609B6AAEA9ABCB0C2E3D4658708566EDAC4DA8876AD747F2AF59A85717BFAF54A3F8F93FB508AEEC9C62956BF70B89C626A6FA9B5D745D52A9EC3B290AD7F8BE054B6628B47D0458F2CCAABDA4269880766C320F89D8F39CBB3ABDA7049059B82D245A3EDE11C7F68BD87F8EFBC13F0958AF8662F06BEF8303E613366FCBA7612D872CC6C8DE0E291CA1073D61DC297A83B4CDC15EC37319D7FBB2D56E7541DE1A27EFA549D7BD4E9292FB0BF9D8FBC3F72916372F1EB7D21B547AE2532FA98EC933FFB4FB1D33CFC6AF3E78BF0CA1E39B7E0C0338F95AD86FC09B39FD325EF369CEE3442F6DF9D2F393AFE3FC645B703DF680CEC9B028B9B0E4BCD24C140175C5D3543F5CD88EB46C42E3DAF35437698ED345F1B8C8F5D73E7CB4C8B6E2383D46A7C3441562B365B42984F2802C216A9EA3D17629A54DCB62CAAB65845EE1234C5AB889E48CDA634D4F83804A5F2776B9F29CF70CB593C81E8425C673ACD341E19E2096FBDAF3339D2A73F1F89DB360FAFD3FCB5EE731C01CD64E636BD163F678C47B5DDE76E915F056192AFBC394C2CB5B941668B1AE92A111B0295EEAB6BC61DC4294730752D02FA08BBD886CCFD08331A2EAA7E7435C8FA40B4DD3E3C65742669AC4A8CA5BCF910E89B2F81EFFE057000F0D33B1C0000 , N'6.1.0-30225')
END

